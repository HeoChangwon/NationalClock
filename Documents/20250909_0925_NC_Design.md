# National Clock - Design Document

**문서 정보**
- 작성일: 2025년 9월 9일
- 프로젝트: National Clock
- 버전: 1.0

## 1. 시스템 아키텍처

### 1.1 전체 아키텍처
```
┌─────────────────────────────────────┐
│           Presentation Layer         │
│  ┌─────────────┐  ┌─────────────┐   │
│  │ MainWindow  │  │ SettingsWin │   │
│  │ (Material)  │  │ (Material)  │   │
│  └─────────────┘  └─────────────┘   │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│          Business Logic Layer       │
│  ┌─────────────┐  ┌─────────────┐   │
│  │TimeZoneManager│ │ClockService │   │
│  │ ThemeManager │  │             │   │
│  └─────────────┘  └─────────────┘   │
└─────────────────┬───────────────────┘
                  │
┌─────────────────┴───────────────────┐
│            Data Layer               │
│  ┌─────────────┐  ┌─────────────┐   │
│  │  TimeZone   │  │   Settings  │   │
│  │   Models    │  │   Storage   │   │
│  └─────────────┘  └─────────────┘   │
└─────────────────────────────────────┘
```

### 1.2 패턴 적용
- **MVVM 패턴**: WPF의 데이터 바인딩과 명령 처리
- **Singleton 패턴**: TimeZoneManager, SettingsManager, ThemeManager
- **Observer 패턴**: 시간 업데이트 알림, 테마 변경 알림
- **Strategy 패턴**: 다크/라이트 테마 처리

## 2. 클래스 설계

### 2.0 Theme 관리 클래스

#### ThemeManager 클래스
```csharp
public class ThemeManager : INotifyPropertyChanged
{
    private static ThemeManager _instance;
    public static ThemeManager Instance { get; }
    
    public bool IsDarkMode { get; set; }
    public event PropertyChangedEventHandler PropertyChanged;
    
    public void ApplyTheme(bool isDarkMode);
    public ResourceDictionary GetThemeResourceDictionary();
    public void LoadThemeResources();
}
```

### 2.1 Model 클래스

#### TimeZoneInfo 클래스
```csharp
public class TimeZoneInfo
{
    public string Id { get; set; }           // "Korea Standard Time"
    public string DisplayName { get; set; }  // "한국"
    public string TimeZoneId { get; set; }   // System TimeZone ID
    public string FlagEmoji { get; set; }    // "🇰🇷"
    public string FlagImagePath { get; set; } // "/Images/Flags/kr.png"
    public bool IsEnabled { get; set; }      // 표시 여부
    public int DisplayOrder { get; set; }    // 표시 순서
}
```

#### ClockInfo 클래스
```csharp
public class ClockInfo : INotifyPropertyChanged
{
    public TimeZoneInfo TimeZone { get; set; }
    public DateTime CurrentTime { get; set; }
    public string FormattedTime { get; set; }
    public string DateString { get; set; }
    public bool Is24HourFormat { get; set; }
}
```

### 2.2 Service 클래스

#### TimeZoneManager 클래스
```csharp
public class TimeZoneManager : INotifyPropertyChanged
{
    private static TimeZoneManager _instance;
    public static TimeZoneManager Instance { get; }
    
    public ObservableCollection<TimeZoneInfo> AvailableTimeZones { get; }
    public ObservableCollection<TimeZoneInfo> EnabledTimeZones { get; }
    
    public void AddTimeZone(TimeZoneInfo timeZone);
    public void RemoveTimeZone(string timeZoneId);
    public void UpdateDisplayOrder(List<string> orderedIds);
    public DateTime GetTimeForZone(string timeZoneId);
}
```

#### ClockService 클래스
```csharp
public class ClockService : INotifyPropertyChanged
{
    private DispatcherTimer _timer;
    public ObservableCollection<ClockInfo> Clocks { get; }
    public bool Is24HourFormat { get; set; }
    
    public void StartClock();
    public void StopClock();
    public void UpdateTimeFormat(bool is24Hour);
    private void UpdateAllClocks();
}
```

#### SettingsManager 클래스
```csharp
public class SettingsManager
{
    private static SettingsManager _instance;
    public static SettingsManager Instance { get; }
    
    public bool Is24HourFormat { get; set; }
    public List<string> EnabledTimeZoneIds { get; set; }
    public Dictionary<string, int> TimeZoneDisplayOrder { get; set; }
    public bool IsDarkMode { get; set; }
    public bool IsAlwaysOnTop { get; set; }
    
    public void SaveSettings();
    public void LoadSettings();
}
```

### 2.3 ViewModel 클래스

#### MainViewModel 클래스
```csharp
public class MainViewModel : INotifyPropertyChanged
{
    public ClockService ClockService { get; }
    public TimeZoneManager TimeZoneManager { get; }
    public ThemeManager ThemeManager { get; }
    
    public ICommand ToggleFormatCommand { get; }
    public ICommand OpenSettingsCommand { get; }
    public ICommand AddTimeZoneCommand { get; }
    public ICommand RemoveTimeZoneCommand { get; }
    public ICommand ToggleThemeCommand { get; }
    public ICommand ToggleAlwaysOnTopCommand { get; }
    
    public string WindowTitle { get; }
    public bool Is24HourFormat { get; set; }
    public bool IsDarkMode { get; set; }
    public bool IsAlwaysOnTop { get; set; }
}
```

#### SettingsViewModel 클래스
```csharp
public class SettingsViewModel : INotifyPropertyChanged
{
    public ObservableCollection<TimeZoneInfo> AvailableTimeZones { get; }
    public ObservableCollection<TimeZoneInfo> EnabledTimeZones { get; }
    
    public ICommand AddTimeZoneCommand { get; }
    public ICommand RemoveTimeZoneCommand { get; }
    public ICommand MoveUpCommand { get; }
    public ICommand MoveDownCommand { get; }
    public ICommand SaveCommand { get; }
    public ICommand CancelCommand { get; }
    
    public bool IsDarkMode { get; set; }
    public bool IsAlwaysOnTop { get; set; }
    public bool Is24HourFormat { get; set; }
}
```

## 3. UI 설계

### 3.1 MainWindow 레이아웃 (Material Design)
```
┌─────────────────────────────────────────┐
│ ☰ National Clock    [🌙][📌][12H][⚙️] │
├─────────────────────────────────────────┤
│ ┌─────────────────────────────────────┐ │
│ │ 🇰🇷🖼️ 한국 (서울)                    │ │
│ │    오후 09:24:15                    │ │
│ │    2025년 9월 9일 월요일             │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ 🇺🇸🖼️ 미국 (미시간주)                │ │
│ │    오전 08:24:15                    │ │
│ │    September 9, 2025 Monday       │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ 🇵🇱🖼️ 폴란드 (바르샤바)              │ │
│ │    오후 02:24:15                    │ │
│ │    9 września 2025 poniedziałek    │ │
│ └─────────────────────────────────────┘ │
│                                         │
│          ➕ 타임존 추가                  │
└─────────────────────────────────────────┘
```

**아이콘 설명:**
- 🌙: 다크/라이트 모드 토글
- 📌: 창 항상 위에 표시 토글  
- 🖼️: 국기 이미지 표시 영역

### 3.2 Settings Window 레이아웃 (Material Design)
```
┌─────────────────────────────────────────┐
│ ⚙️ 설정                                 │
├─────────────────────────────────────────┤
│ 📋 일반 설정                            │
│ ┌─────────────────────────────────────┐ │
│ │ 시간 형식                           │ │
│ │ ○ 12시간 (AM/PM)  ● 24시간         │ │
│ │                                     │ │
│ │ 테마                                │ │
│ │ ○ 라이트 모드     ● 다크 모드      │ │
│ │                                     │ │
│ │ ☑️ 창 항상 위에 표시                │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 🌍 타임존 관리                          │
│ ┌─────────────────┐ ┌─────────────────┐ │
│ │ 사용 가능       │ │ 선택된 타임존   │ │
│ │ 🇯🇵 일본 (도쿄)  │ │ 1.🇰🇷한국(서울) │ │
│ │ 🇬🇧 영국 (런던)  │ │ 2.🇺🇸미국(미시간)│ │
│ │ 🇫🇷 프랑스(파리) │ │ 3.🇵🇱폴란드(바르샤바)│ │
│ │ 🇨🇳 중국 (베이징) │ │                 │ │
│ │ ...             │ │                 │ │
│ └─────────────────┘ └─────────────────┘ │
│     [➡️ 추가]        [⬆️] [⬇️] [❌ 제거] │
│                                         │
│                   [✅ 확인]   [❌ 취소]   │
└─────────────────────────────────────────┘
```

## 4. 데이터 저장 방식

### 4.1 설정 파일 (settings.json)
```json
{
  "timeFormat": "24Hour",
  "theme": {
    "isDarkMode": false,
    "isAlwaysOnTop": false
  },
  "enabledTimeZones": [
    {
      "id": "Korea Standard Time",
      "displayName": "한국",
      "flagEmoji": "🇰🇷",
      "flagImagePath": "/Images/Flags/kr.png",
      "displayOrder": 1,
      "isEnabled": true
    },
    {
      "id": "Eastern Standard Time",
      "displayName": "미국 (미시간주)",
      "flagEmoji": "🇺🇸",
      "flagImagePath": "/Images/Flags/us.png",
      "displayOrder": 2,
      "isEnabled": true
    },
    {
      "id": "Central European Standard Time",
      "displayName": "폴란드",
      "flagEmoji": "🇵🇱",
      "flagImagePath": "/Images/Flags/pl.png",
      "displayOrder": 3,
      "isEnabled": true
    }
  ],
  "windowSettings": {
    "width": 400,
    "height": 600,
    "left": 100,
    "top": 100
  }
}
```

## 5. 기술 스택 및 의존성

### 5.1 개발 환경
- **IDE**: Visual Studio 2022
- **Framework**: .NET 8.0
- **UI Framework**: WPF (Windows Presentation Foundation)
- **언어**: C# 12.0+
- **Design System**: Material Design

### 5.2 주요 라이브러리
- **System.Text.Json**: 설정 파일 직렬화/역직렬화
- **System.ComponentModel**: INotifyPropertyChanged 구현
- **System.Windows.Threading**: DispatcherTimer 사용
- **System.Globalization**: 다국어 날짜/시간 형식
- **MaterialDesignThemes**: Material Design UI 구현
- **MaterialDesignColors**: Material Design 색상 팔레트

### 5.3 프로젝트 구조
```
NationalClock/
├── NationalClock.sln
├── NationalClock/
│   ├── Models/
│   │   ├── TimeZoneInfo.cs
│   │   ├── ClockInfo.cs
│   │   └── Settings.cs
│   ├── Services/
│   │   ├── TimeZoneManager.cs
│   │   ├── ClockService.cs
│   │   └── SettingsManager.cs
│   ├── ViewModels/
│   │   ├── MainViewModel.cs
│   │   ├── SettingsViewModel.cs
│   │   └── BaseViewModel.cs
│   ├── Views/
│   │   ├── MainWindow.xaml
│   │   ├── MainWindow.xaml.cs
│   │   ├── SettingsWindow.xaml
│   │   └── SettingsWindow.xaml.cs
│   ├── Resources/
│   │   ├── Styles/
│   │   │   ├── MaterialDark.xaml
│   │   │   ├── MaterialLight.xaml
│   │   │   └── Common.xaml
│   │   ├── Images/
│   │   │   └── Flags/
│   │   │       ├── kr.png
│   │   │       ├── us.png
│   │   │       ├── pl.png
│   │   │       └── ...
│   │   └── Themes/
│   ├── App.xaml
│   ├── App.xaml.cs
│   └── NationalClock.csproj
├── Tests/
│   └── NationalClock.Tests/
└── Documents/
    ├── Requirements.md
    ├── Design.md
    └── TaskList.md
```

## 6. 성능 고려사항

### 6.1 메모리 최적화
- 사용하지 않는 TimeZone 객체 해제
- Timer 이벤트 핸들러 적절한 해제
- 이미지 리소스 캐싱 및 지연 로딩
- Material Design 리소스 효율적 관리
- 테마 변경 시 불필요한 리소스 해제

### 6.2 UI 응답성
- UI 스레드 블로킹 방지
- 백그라운드 작업 시 async/await 사용
- 대량 데이터 바인딩 시 가상화 고려

## 7. 보안 고려사항

### 7.1 데이터 보호
- 설정 파일 무결성 검증
- 사용자 입력 검증

### 7.2 권한 관리
- 최소 권한 원칙 적용
- 파일 시스템 접근 권한 최소화

## 8. 테스트 전략

### 8.1 단위 테스트
- TimeZoneManager 메서드 테스트
- 시간 계산 로직 테스트
- 설정 저장/로드 테스트

### 8.2 통합 테스트
- UI와 비즈니스 로직 연동 테스트
- 실제 시간 업데이트 테스트

### 8.3 사용자 시나리오 테스트
- 기본 사용 시나리오 검증
- 설정 변경 시나리오 검증